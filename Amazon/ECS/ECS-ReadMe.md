## ECS를 사용해 보자

### 용어 설명

- 클러스터 : 독립된 물리적인 공간이다. 나중에 만들고 보면 VPC로 새로운 공간을 만들어 놓은 것을 볼 수 있다.
- task definition : 작업정의라고 설정파일을 만든다고 보면 된다. 다음 내용을 정의한다
  - 어떤 클러스터를 쓸지
  - 해당 클러스터의 어떤 서브넷을 사용할지
  - vpc의 보안설정은 어떻게 할지
  - 클러스터 내의 통신은 어떻게 할지
  - Auto Scaling을 할지? 하게되면 몇개까지 확장할 것인지
  - 어떤 컨테이너를 쓸 것이며 컨테이너에 얼마의 리소스를 할당할 것인지
    - 컨테이너의 로그는 무엇으로 할지
    - environment는 무엇인지
- task : task definition의 실행을 정의한다. 여기까지 하면 ip4의 외부 아이피까지 생성한다.
- Service : task로 만들었지만 Auto Scaling 이 있으므로 하나의 task에 도메인을 붙이는 (이럴거면 그냥 EC2쓰지) 행동은 하지 않을 것이다. 이것을 위해 Load Balancer 로 연결할 것이며 이것을 위한 것이 서비스이다.
- 추후 공부를 하면 더 많이 쓰임을 알겠지만 기본적인 ECS를 사용하기 위해선 이정도(밖에 현재 못찾았다)면 된다.

### 시작하기 전에

- 우선 ECS를 사용하는 방법은 ReadMe에 한번 언급했던 2가지 방법이 있다. 두개의 차이를 개인적으로 이렇게 해석했다.
  - Fargate + ECS
  - EC2 + ECS
-  요금의 차이.
  - Fargate + ECS :  할당 cpu + memory + 클릭 액션타임 ...
  - EC2 + ECS : EC2 인스턴스 요금
- 사용 용이성의 차이(이건 100% 개인적인 의견)
  - 개인적으로는 Fargate + ECS가 입문자에게 편하게 느껴졌다.(참고한 레퍼런스의 차이도 있긴 하지만) 그리고 AWS는 FarGate를 밀어준다는 느낌이 들었다
  - 시작하기를 누르면 Fargate + ECS의 샘플 예제를 보여준다. 이것만 보더라도 어느정도 ECS를 쉽게 이해하는데 도움을 준다(물론 아무것도 모르고 하면 똑같지만)
  - 레퍼런스에서 설명해 주지 않던 container간의 통신도 Fargate는 쉽게 해결해준다는 인상을 받았다.
- 개인적으론 Fargate + ECS를 먼저 해보길 권한다. 그 후 EC2 + ECS를 해보길 개인적으로 추천한다.
- 이것이 다 되고 Kubernetes를 다루고 싶다면 EKS를 하면 될 것이다.

### 나의 설정

- 초기에는 하나의 task에서 web과 api를 동시에 작동시키려 했다. 그런데 그렇게 하면 둘 중 하나만 증가해야 하는 상황에서 둘다 증가하는 문제가 생기게 된다. 그래서 다음과 같은 방법으로 진행했다.
- alb -> web server -> alb -> api server -> data base
- 초기 설정시엔 현실적인(금액)문제에 의해 data base에 auto scale등의 설정은 하지 않은 상태이다. 

- 처음에는 EC2 + ECS로 진행하려 했으나 [Fargate + ECS](ECS-Fargate.md) 로 진행하기로 했다. 
