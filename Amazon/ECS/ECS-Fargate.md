# ECS에 서비스 올리기

### 선행정보

- 작성일 : 2020-03-18
- 아래 내용중에 책이라는 항목이 있는데 책 제목은 '당신이 지금 알아야 할 AWS'이다.
- 아래는 11장 ECS 컨테이너 서비스에 있는 내용을 기준으로 작성. 정리한 글이다.

### 시작하기 전에

- VPC, SubNet, Route Table, Internet Gateway에 각각 Default의 이름을 적어두기 바란다.
- 왜냐하면 시작하기를 통해서 ECS를 만들면 알아서 이름을 정의해 주지만(security group, load balacer등은 예외) 나머지는 이름을 만들어준다. 단 수동으로 클러스터 만들고 하면 이름이 공란이 되므로 햇갈리지 않게 미리 넣어주는게 좋다.
- 전체적인 구성을 보고 싶으면 시작하기를 눌러보는 것도 좋다. 거기서 sample-app, nginx, tomcat-webser의 샘플을 만들어서 보여주므로 참고해 두는 것도 좋을 것이다.
- task definition은 삭제할 수 없으므로 이름을 Sample같은 거로 적지 말자. 추후 작업정의를 변경하려면 작업정의를 선택한 후 세 계정을 만든 후 전의 작업정의를 사용하고 있던 service의 버전을 변경해주면 된다.
- 클러스터는 지워도 된다(안지우면 돈이다) 그런데 삭제하다 보면 지우는걸 실패하는 경우가 있다. 이땐 VPC에서 VPC, SubNet, Route Table, Internet Gateway를 지운 후 클러스터를 삭제하자(단 삭제순서는 반대다 VPC를 맨 마지막에 지워주자)
- 컨테이너가 변경된 경우에는 작업정의를 업데이트 하는게 아니다. 컨테이너를 변경할 서비스에서 업데이트를 선택한 후 **새 배포 적용** 을 선택(체크박스)하고 업데이트를 하면 작업정의는 그대로이고 컨테이너만 변경된다.

### 클러스터 만들기

- ECS가 작동되는 vpc인 클러스터를 먼저 생성해야 한다. 클러스터 생성을 선택하자. 그럼 다음의 세가지 항목이 나온다.

  - 네트워킹 전용
  - EC2 Linux + Networking
  - EC2 Windows + Networking

  저기서 네트워킹 전용이 Fargate 이다. 네트워킹 전용을 선택하자

- 클러스터 구성에서는 이름과 tag를 정해주고 VPC 생성을 선택하면 vpc까지 만들어주는 친절함을 보여준다.

- 업데이트 시에는 auto scaling에 의한 작업량 변경만이 가능한 듯 하다. 따라서 새로운 작업정의를 만들어야 한다.

