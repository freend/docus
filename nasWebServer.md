## nas에 홈페이지 올리기
### 개요
원래 사용하던 서비스 모델은 아마존 EC2, RDS를 서버로 사용하고 있었다.
서비스를 중단할 상황에 처하게 되었으나 서비스를 유지할 방법을 찾던 중 다음과 같은 방법으로 서비스를 좀더 이어가도록 하기로 했다.
우리가 서비스를 유지하고 싶어하기도 했고, 유료사용자들을 위해서라도 필요했기 때문이다.

1. aws 서비스를 사용중지하며 웹과 db를 nas로 이동한다.
2. 도메인 포워딩을 통해서 어플을 변경하지 않으면서 서비스에 접속하도록 한다.

위의 두가지를 전제조건으로 다음의 작업을 진행했다.

### synology nas에 웹서버를 구축하기
기종 및 서버 구성은 다음과 같다.
1. nas : synology ds216j
2. shared adapter : iptime A604

#### 서버구성
tomcat7, java8, spring framework4, mybatis
mariadb5 : 원래는 mysql이었으나 synology nas에는 mariadb 설치가 용이해서 이전했다.
mariadb는 5와 10버전이 있으나 10은 mysql과의 호완성이 없다는 정보를 인터넷에서 얻어서 5버전으로 작업했다.

#### 작업과정
1. 처음에 할 일은 nas가 외부에서 접속하게 할 수 있도록 하는 것이다. 이를 위해
제어판 -> 외부억세스 -> DDNS에서 외부접속이 가능하게 하자.
해당 방법은 <a href="https://nas.moe/archives/648" target="_blank">참조사이트</a>를 참조하자.

2. 다음은 제어판 -> 외부억세스 -> 라우터 구성에서 사용을 원하는 포트를 열어주자.
나는 외부에서 tomcat의 접속, mysql의 접속을 위해 8080과 3456포트를 연다고 가정한다.
7070은 nas에 tomcat 설치시 기본 포트이다. 여기서 포트를 바꾼건 나중에 tomcat에서 포트번호를 변경하는 부분까지 작성하기 위해서이다.
라우터 구성에서 생성, 사용자 지정포트 해서 각각 포트를 생성해준다.
연결테스트를 한 결과 재대로 되면 나스가 외부랑 연결된 준비를 마친 것이다.

3. 다음은 라우터에서 포트를 열어줘야 한다. 이것을 열어주지 않으면 외부와의
연결은 영영 막힌 것이다.
위의 주소를 참조하면 된다. 단 내부 IP주소는 본인의 nas가 되어야 한다.
외부포트는 내부포트랑 달라도 상관없다. 단 외부에서 접속할때는 외부포트 번호로 해야 하며
2개를 연 후 내부포트는 위에서 임의로 설정한 8080과 3456포트로 적어주면 된다.
편하게 하려면 두개의 포트를 같게 설정해도 된다.
<a href="http://brand-me.tistory.com/194" target="_blank">참조사이트</a>

아직 java와 tomcat을 연결해주지 않아서 확인은 불가능하다.
